<!DOCTYPE html>
<html>
<head>
    <title>Appel DLL Rust depuis Web</title>
    <style>
        body {
            background-color: black;
            display: flex;
            flex-direction: column; /* Organise les enfants en colonne */
            justify-content: center; /* Centre horizontalement */
            align-items: center; /* Centre verticalement */
            height: 100vh; /* Utilise 100% de la hauteur de la fenêtre */
            margin: 0; /* Enlève les marges par défaut */
            background-image: url('../images/ia.png'); /* Ajoutez le chemin relatif de votre image */
            background-size: cover; /* Assure que l'image couvre tout l'espace disponible */
            background-position: center; /* Centre l'image */
            background-repeat: no-repeat; /* Empêche la répétition de l'image */
        }


        .button {
            background-color: #04AA6D;
            border: none;
            color: white;
            text-align: center;
            padding: 15px 32px;
            text-decoration: none;
            font-size: 16px;
            cursor: pointer;
            margin-top: 20px; /* Ajoute un espace au-dessus du bouton */
        }
        .button:hover {
            background-color: #037f58;
        }

        .button_reload {
            background-color: #2474b5;
            border: none;
            color: white;
            text-align: center;
            padding: 15px 32px;
            text-decoration: none;
            font-size: 16px;
            cursor: pointer;
            margin-top: 20px; /* Ajoute un espace au-dessus du bouton */
        }
        .button_reload:hover {
            background-color: #19578a;
        }

        .radio-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .radio-group input[type="radio"] {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border: 2px solid #04AA6D;
            border-radius: 50%;
            outline: none;
            cursor: pointer;
        }

        .radio-group label {
            margin: 0;
            cursor: pointer;
        }

        .radio-group input[type="radio"]:checked {
            background-color: #04AA6D;
        }

        select, .radio-group {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
            background-color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            outline: none;
        }

        .label{
            color: white;
            display: flex;
            justify-content: center;
            margin: auto;
        }
        .parent_radio_div{
            display: flex;
            justify-content: center;
            width: 10%;
        }
        .child_radio_div{
            display: flex;
            justify-content: center;
            width: 100%;
        }
        .hidden_div{
            display:none;
        }
        .res_prediction{
            margin-top: 20px;
            background-color: white;
            color: black;
            font-weight: bold;
            font-size: 28px;
            padding: 1%;
        }
        .loader {
            border: 16px solid #f3f3f3; /* Light grey */
            border-top: 16px solid #3498db; /* Blue */
            border-radius: 50%;
            width: 120px;
            height: 120px;
            animation: spin 2s linear infinite;
            margin: auto;
            margin-top: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
<!--<button id="reloadServer" class="button_reload">Reload DLL</button>-->
<h1 style="color:white;font-weight:bold">Machine Learning</h1>
<select  id="modelSelect">
    <option selected>-- Select Model --</option>
    <option value="linear_model">Linear Model</option>
    <option value="mlp_model">MLP Model</option>
    <option value="rbfn_model">RBFN Model</option>
</select>

<select class="hidden_div" id="modelSelectCategory">
    <option value=2>Aubergine</option>
    <option value=1>Orange</option>
    <option value=0>Tomate</option>
</select>


<div class="parent_radio_div">
    <div class="child_radio_div">
        <input class="radio-group" type="radio" id="train" name="mode" value="train" checked>
        <label class="label" for="train">Train</label>
    </div>
    <div class="child_radio_div">
        <input class="radio-group"type="radio" id="predict" name="mode" value="predict">
        <label class="label" for="predict">Predict</label>
    </div>
</div>

<form id="imageForm" class="hidden_div" enctype="multipart/form-data">
    <input type="file" id="imageInput" name="image" accept="image/*">
    <button type="button" id="submitImage" class="button">Envoyer Image</button>
</form>
<div id="dimensionSelection"class="parent_radio_div hidden_div">
    <div class="child_radio_div">
        <input class="radio-group" type="radio" id="size32" name="size" value="32" checked>
        <label class="label" for="size32">32x32</label>
    </div>
    <div class="child_radio_div">
        <input class="radio-group" type="radio" id="size16" name="size" value="16">
        <label class="label" for="size16">16x16</label>
    </div>
</div>

<button id="loadModel" class="button">Load Model</button>
<div class="res_prediction" id="resultat"></div>
<div id="resultat_reload"></div>
<div class="loader" id="loader" style="display: none;"></div>
<script>
    /*document.getElementById('reloadServer').addEventListener('click', function() {
        fetch('http://127.0.0.1:5000/reload_dll', { method: 'POST' })
            .then(response => response.json())
            .then(data => console.log(data.message))
            .catch(error => console.error('Error:', error));
    });*/

    document.querySelectorAll('input[name="mode"]').forEach((radio) => {
        radio.addEventListener('change', function() {
            const predictSelected = document.getElementById('predict').checked;
            const imageForm = document.getElementById('imageForm');
            const dimensionSelection = document.getElementById('dimensionSelection');

            if (predictSelected) {
                imageForm.classList.remove('hidden_div');
                dimensionSelection.classList.remove('hidden_div');
            } else {
                imageForm.classList.add('hidden_div');
                dimensionSelection.classList.add('hidden_div');
            }
        });
    });

    // Appeler manuellement l'événement change au chargement de la page pour gérer l'état initial
    document.querySelector('input[name="mode"]:checked').dispatchEvent(new Event('change'));


    document.getElementById('submitImage').addEventListener('click', function() {
        const formData = new FormData();
        const imageFile = document.getElementById('imageInput').files[0];
        const imageSize = document.querySelector('input[name="size"]:checked').value;
        formData.append('image', imageFile);
        formData.append('size', imageSize); // Ajouter la taille d'image sélectionnée

        fetch('http://127.0.0.1:5000/upload_image', {
            method: 'POST',
            body: formData,
        })
            .then(response => response.json())
            .then(data => console.log(data))
            .catch(error => console.error('Error:', error));
    });


    document.getElementById('loadModel').addEventListener('click', async () => { // Ajout de async ici
        document.getElementById('loader').style.display = 'block';
        const model = document.getElementById('modelSelect').value;
        const mode = document.querySelector('input[name="mode"]:checked').value;
        const category = parseInt(document.getElementById('modelSelectCategory').value, 10);
        const categoryElement = document.getElementById('modelSelectCategory');
        const categoryText = categoryElement.options[categoryElement.selectedIndex].text;

        try {
            const response = await fetch('http://127.0.0.1:5000/run_algo', { // Utilisation de await
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ model, mode, category }),
            });
            const data = await response.json(); // Utilisation de await

            document.getElementById('loader').style.display = 'none';
            console.log(mode);
            let prediction = "Training"; // Initialisation par défaut à "Training"

            if (mode == "predict") {
                switch(data.model) {
                    case "linear_model":
                        prediction = data.prediction == 1 ? categoryText : "Image inconnue";
                        break;
                    case "mlp_model":
                        prediction = data.prediction == 2 ? "Tomate" : data.prediction == 1 ? "Orange" : "Aubergine";
                        break;
                    case "rbfn_model":
                        prediction = data.prediction == 0 ? "Tomate" : data.prediction == 1 ? "Orange" : "Aubergine";
                        break;
                }
            }

            document.getElementById('resultat').textContent = 'Prediction : ' + prediction;
        } catch (error) {
            console.error('Erreur:', error);
            document.getElementById('loader').style.display = 'none';
            document.getElementById('resultat').textContent = 'Erreur lors de la prédiction';
        }
    });

    document.getElementById('modelSelect').addEventListener('change', function() {
        const selected = this.value === "linear_model";
        selectLinear(selected);
    });

    function selectLinear(selected){
        if(selected){
            var element = document.getElementById("modelSelectCategory");
            element.classList.remove("hidden_div");
        }
        else{
            var element = document.getElementById("modelSelectCategory");
            element.classList.add("hidden_div");
        }

    }


</script>
</body>
</html>